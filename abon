index.html
<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>KAVALAN å™¶ç‘ªè˜­å¤§å¯Œç¿ â€” å°ˆé¡Œå±•ç¤ºç‰ˆ</title>
<style>
  :root{
    --gold: #d4af37; --bg: #051411; --text: #f1f1f1;
    --accent: #d4af37; --panel: rgba(10, 30, 25, 0.9);
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  body{
    margin:0; font-family:"Noto Sans TC", sans-serif;
    /* èƒŒæ™¯ä½¿ç”¨ä½ æä¾›çš„é…’å» ç¾åœ– */
    background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.8)), url('https://i.imgur.com/k6lP09L.png') no-repeat center center fixed;
    background-size: cover; color: var(--text); overflow: hidden; height: 100vh;
  }
  .app{ height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding-bottom: env(safe-area-inset-bottom); }
  
  header{ width: 100%; max-width: 800px; display: flex; justify-content: space-between; align-items: center; padding: 15px; z-index: 10; }
  .logo{ font-weight: 900; color: var(--gold); font-size: 1.2rem; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
  .btn-small{ background: rgba(0,0,0,0.4); border: 1px solid var(--gold); color: white; padding: 6px 12px; border-radius: 8px; font-size: 12px; margin-left: 5px; cursor: pointer;}

  main{ flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
  .board-wrap{ width: min(650px, 92vw); aspect-ratio: 1/1; position: relative; }
  .board-inner{ 
    width: 100%; height: 100%; background: var(--panel); border: 2px solid var(--gold); 
    border-radius: 15px; position: relative; backdrop-filter: blur(10px); 
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
  }

  /* æ ¼å­æ¨£å¼å„ªåŒ– */
  .space{
    position:absolute; display:flex; flex-direction:column; align-items:center; justify-content:center; 
    padding:4px; border-radius:8px; text-align:center; font-size:clamp(10px, 2.5vw, 12px);
    border: 1px solid rgba(212, 175, 55, 0.2); background: rgba(255,255,255,0.03);
    overflow: hidden;
  }
  .space .name{ font-weight: 800; color: var(--gold); margin-bottom: 2px; line-height: 1.1; }
  .space .icon{ font-size: 1.4rem; margin-top: 2px; }

  /* æ£‹å­æ¨£å¼ */
  .player-pawn{
    position:absolute; width:30px; height:30px; border-radius:50%; 
    display:flex; align-items:center; justify-content:center; 
    font-size:14px; color:#fff; font-weight:900; 
    border:2px solid #fff; z-index:100; transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    box-shadow: 0 0 15px rgba(255,255,255,0.4);
  }

  /* æ§åˆ¶æ¿ */
  .control-panel {
    width: 92%; max-width: 500px; background: rgba(0,0,0,0.85); 
    padding: 12px 20px; border-radius: 20px; border: 1px solid var(--gold);
    display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
  }
  .dice{ background: var(--gold); color: #000; padding: 10px 18px; border-radius: 12px; font-weight: 900; font-size: 1.4rem; min-width: 55px; text-align: center; }
  .btn-roll{ background: linear-gradient(135deg, #d4af37, #aa8a2e); color: #000; border: none; padding: 12px 25px; border-radius: 14px; font-weight: 800; font-size: 16px; cursor: pointer; }

  /* å½ˆçª— */
  .modal-root{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.85); z-index:1000; visibility:hidden; opacity:0; transition:0.3s; }
  .modal-root.show{ visibility:visible; opacity:1; }
  .modal{ background: #0a1e19; border: 2px solid var(--gold); padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; color: white; }
  .modal h3 { color: var(--gold); margin-top: 0; }
  .modal button { background: var(--gold); border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; margin-top: 15px; cursor: pointer; }

  .owner-bar{display:flex; gap:2px; margin-top:4px; min-height:12px; justify-content: center;}
  .bottle{width:14px; height:14px; border-radius:4px; font-size:10px; display: flex; align-items: center; justify-content: center; color: white;}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">ğŸ¥ƒ KAVALAN å™¶ç‘ªè˜­å¤§å¯Œç¿</div>
      <div>
        <button id="btn-howto" class="btn-small">ç©æ³•</button>
        <button id="btn-reset" class="btn-small">é‡è¨­éŠæˆ²</button>
      </div>
    </header>

    <main>
      <div class="board-wrap">
        <div class="board-inner" id="board-inner"></div>
      </div>
    </main>

    <div class="control-panel">
      <div id="cpTurn" style="color:var(--gold); font-weight:bold; font-size:14px; max-width: 120px;">ğŸ¯ è«‹å…ˆé»æ“Šé‡è¨­</div>
      <div id="diceDisplay" class="dice">?</div>
      <button id="rollBtn" class="btn-roll">ğŸ² æ“²éª°å­</button>
    </div>

    <div id="modal-root" class="modal-root"><div class="modal" id="modal"></div></div>
  </div>

<script>
// --- æ ¸å¿ƒéŠæˆ²é‚è¼¯ (åŸºæ–¼ v6.5 ä¿®æ”¹) ---
const BOARD = [
  { type:'start', name:'èµ·é»' },
  { type:'property', id:'classic', name:'ç¶“å…¸å–®ä¸€éº¥èŠ½', price:800, rent:200 },
  { type:'chance', name:'æ©Ÿæœƒ' },
  { type:'property', id:'ex-bourbon', name:'æ³¢æœ¬æ¡¶ç†Ÿæˆ', price:1200, rent:300 },
  { type:'hospital', name:'é†«é™¢' },
  { type:'property', id:'sherry', name:'é›ªè‰æ¡¶', price:1500, rent:350 },
  { type:'property', id:'concert', name:'Concertmaster', price:1800, rent:400 },
  { type:'property', id:'vinho', name:'è‘¡è„é…’æ¡¶', price:2500, rent:600 },
  { type:'jail', name:'ç›£ç„' },
  { type:'property', id:'peaty', name:'æ³¥ç…¤æ¡¶', price:2200, rent:500 },
  { type:'destiny', name:'å‘½é‹' },
  { type:'property', id:'oloroso', name:'Oloroso é›ªè‰', price:2800, rent:650 },
  { type:'parking', name:'åœè»Šå ´' },
  { type:'property', id:'solist', name:'Solist ç³»åˆ—', price:3000, rent:700 },
  { type:'property', id:'limited', name:'é™é‡æ¬¾', price:3200, rent:750 },
  { type:'chance', name:'æ©Ÿæœƒ' }
];

const GRID = [[0,0],[0,1],[0,2],[0,3],[0,4],[1,4],[2,4],[3,4],[4,4],[4,3],[4,2],[4,1],[4,0],[3,0],[2,0],[1,0]];
const PLAYER_COLORS = ['#ef4444','#3b82f6','#22c55e','#f97316','#8b5cf6','#f43f5e'];
let state = { board: BOARD.map(s=>({...s, ownerId:null, level:0})), players:[], current:0, moving:false };

const modalRoot = document.getElementById('modal-root');
const modal = document.getElementById('modal');

function openModal(html){ modal.innerHTML = html; modalRoot.classList.add('show'); }
function closeModal(){ modalRoot.classList.remove('show'); }

function layoutBoard(){
  const board = document.getElementById('board-inner');
  board.innerHTML = '';
  const cellW = board.clientWidth / 5;
  
  state.board.forEach((s, i) => {
    const [r, c] = GRID[i];
    const el = document.createElement('div');
    el.className = 'space';
    el.style.width = cellW + 'px'; el.style.height = cellW + 'px';
    el.style.left = (c * cellW) + 'px'; el.style.top = (r * cellW) + 'px';
    el.innerHTML = `<div class="name">${s.name}</div><div class="icon">${getIcon(s.type)}</div><div class="owner-bar" id="owner-${i}"></div>`;
    board.appendChild(el);
  });
  
  state.players.forEach(p => {
    const pawn = document.createElement('div');
    pawn.className = 'player-pawn'; pawn.id = `pawn-${p.id}`;
    pawn.style.background = PLAYER_COLORS[p.id]; pawn.innerText = p.id+1;
    board.appendChild(pawn);
  });
  updatePawns();
}

function getIcon(type){ 
  if(type==='start') return 'ğŸ'; if(type==='chance') return 'â“'; 
  if(type==='hospital') return 'ğŸ¥'; if(type==='jail') return 'ğŸš”'; 
  if(type==='destiny') return 'ğŸ”®'; if(type==='parking') return 'ğŸ…¿ï¸';
  return 'ğŸ¥ƒ'; 
}

function updatePawns(){
  const board = document.getElementById('board-inner');
  if(!board || state.players.length === 0) return;
  const cellW = board.clientWidth / 5;
  
  state.players.forEach(p => {
    const pawn = document.getElementById(`pawn-${p.id}`);
    if(!pawn) return;
    const [r, c] = GRID[p.position];
    pawn.style.left = (c * cellW + (cellW/2) - 15) + 'px';
    pawn.style.top = (r * cellW + (cellW/2) - 15) + 'px';
  });
  const cur = state.players[state.current];
  if(cur) document.getElementById('cpTurn').innerText = `ğŸ¯ ${cur.name}\nğŸ’° $${cur.money}`;
}

document.getElementById('rollBtn').onclick = async () => {
  if(state.moving || state.players.length === 0) return;
  state.moving = true;
  let dice = Math.floor(Math.random()*6)+1;
  document.getElementById('diceDisplay').innerText = dice;
  
  const p = state.players[state.current];
  for(let i=0; i<dice; i++){
    p.position = (p.position + 1) % 16;
    updatePawns();
    await new Promise(r => setTimeout(r, 200));
    if(p.position === 0) {
        p.money += 2000;
        openModal(`<h3>ç¶“éèµ·é»</h3><p>ç²å¾—è¡ŒéŠ·è£œåŠ© $2000</p><button onclick="closeModal()">ç¢ºå®š</button>`);
    }
  }
  state.moving = false;
  handleLand(p);
};

function handleLand(p){
  const s = state.board[p.position];
  if(s.type === 'property'){
    if(s.ownerId === null){
      openModal(`<h3>${s.name}</h3><p>åƒ¹æ ¼ï¼š$${s.price}</p><p>æ˜¯å¦è³¼è²·ç¶“ç‡Ÿæ¬Šï¼Ÿ</p>
        <button onclick="buyProperty(${p.id}, ${p.position})">è³¼è²·</button>
        <button style="background:#555; margin-left:10px;" onclick="nextTurn()">æ”¾æ£„</button>`);
    } else if(s.ownerId !== p.id){
      const rent = s.rent;
      p.money -= rent;
      state.players[s.ownerId].money += rent;
      openModal(`<h3>æ”¯ä»˜è²»ç”¨</h3><p>åœåœ¨ ${state.players[s.ownerId].name} çš„é ˜åœ°</p><p>æ”¯ä»˜ $${rent}</p><button onclick="nextTurn()">ç¢ºå®š</button>`);
    } else {
      nextTurn();
    }
  } else if(s.type === 'chance' || s.type === 'destiny'){
    const gain = (Math.floor(Math.random()*21)-10)*100;
    p.money += gain;
    openModal(`<h3>${s.name}</h3><p>${gain >= 0 ? 'ç²å¾—' : 'æ”¯å‡º'} $${Math.abs(gain)}</p><button onclick="nextTurn()">ç¢ºå®š</button>`);
  } else {
    nextTurn();
  }
}

window.buyProperty = (pid, pos) => {
  const p = state.players[pid];
  const s = state.board[pos];
  if(p.money >= s.price){
    p.money -= s.price;
    s.ownerId = pid;
    s.level = 1;
    const bar = document.getElementById(`owner-${pos}`);
    bar.innerHTML = `<div class="bottle" style="background:${PLAYER_COLORS[pid]}">ğŸ¾</div>`;
    closeModal();
    nextTurn();
  } else {
    alert("é ç®—ä¸è¶³ï¼");
  }
};

window.nextTurn = () => {
  closeModal();
  state.current = (state.current + 1) % state.players.length;
  updatePawns();
};

document.getElementById('btn-reset').onclick = () => {
  const n = prompt("è«‹è¼¸å…¥ç¶“éŠ·å•†(ç©å®¶)äººæ•¸ (2-6)", "4");
  if(!n || n < 2 || n > 6) return;
  state.players = Array.from({length: parseInt(n)}, (_, i) => ({id: i, name: `ç¶“éŠ·å•†${i+1}`, money: 10000, position: 0}));
  state.board.forEach(s => { s.ownerId = null; s.level = 0; });
  layoutBoard();
  document.getElementById('cpTurn').innerText = "ğŸ¯ æº–å‚™é–‹å§‹";
};

document.getElementById('btn-howto').onclick = () => {
    openModal(`<h3>éŠæˆ²ç©æ³•</h3><p>1. æ“²éª°å­ç§»å‹•<br>2. è³¼è²·é…’æ¬¾ç¶“ç‡Ÿæ¬Š<br>3. ç¶“éèµ·é»é ˜è£œåŠ©<br>4. è³‡é‡‘æ­¸é›¶å‰‡æ·˜æ±°</p><button onclick="closeModal()">é–‹å§‹ç¶“ç‡Ÿ</button>`);
};

window.onresize = layoutBoard;
layoutBoard();
</script>
</body>
</html>
